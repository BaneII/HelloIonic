{"ast":null,"code":"import { useState, useEffect } from \"react\";\nimport { useCamera } from '@ionic/react-hooks/camera';\nimport { useFilesystem, base64FromPath } from '@ionic/react-hooks/filesystem';\nimport { useStorage } from '@ionic/react-hooks/storage';\nimport { isPlatform } from '@ionic/react';\nimport { CameraResultType, CameraSource, Capacitor, FilesystemDirectory } from \"@capacitor/core\";\nconst PHOTO_STORAGE = \"photos\";\nexport function usePhotoGallery() {\n  const {\n    get,\n    set\n  } = useStorage();\n  const {\n    deleteFile,\n    getUri,\n    readFile,\n    writeFile\n  } = useFilesystem();\n  const {\n    getPhoto\n  } = useCamera();\n  const [photos, setPhotos] = useState([]);\n\n  const savePicture = async (photo, fileName) => {\n    let base64Data; // \"hybrid\" will detect Cordova or Capacitor;\n\n    if (isPlatform('hybrid')) {\n      const file = await readFile({\n        path: photo.path\n      });\n      base64Data = file.data;\n    } else {\n      base64Data = await base64FromPath(photo.webPath);\n    }\n\n    await writeFile({\n      path: fileName,\n      data: base64Data,\n      directory: FilesystemDirectory.Data\n    });\n    return getPhotoFile(photo, fileName);\n  };\n\n  const deletePhoto = async photo => {\n    // Remove this photo from the Photos reference data array\n    const newPhotos = photos.filter(p => p.filepath !== photo.filepath); // Update photos array cache by overwriting the existing photo array\n\n    set(PHOTO_STORAGE, JSON.stringify(newPhotos)); // delete photo file from filesystem\n\n    const filename = photo.filepath.substr(photo.filepath.lastIndexOf('/') + 1);\n    await deleteFile({\n      path: filename,\n      directory: FilesystemDirectory.Data\n    });\n    setPhotos(newPhotos);\n  };\n\n  const getPhotoFile = async (cameraPhoto, fileName) => {\n    if (isPlatform('hybrid')) {\n      // Get the new, complete filepath of the photo saved on filesystem\n      const fileUri = await getUri({\n        directory: FilesystemDirectory.Data,\n        path: fileName\n      }); // Display the new image by rewriting the 'file://' path to HTTP\n      // Details: https://ionicframework.com/docs/core-concepts/webview#file-protocol\n\n      return {\n        filepath: fileUri.uri,\n        webviewPath: Capacitor.convertFileSrc(fileUri.uri)\n      };\n    } else {\n      // Use webPath to display the new image instead of base64 since it's\n      // already loaded into memory\n      return {\n        filepath: fileName,\n        webviewPath: cameraPhoto.webPath\n      };\n    }\n  };\n\n  useEffect(() => {\n    const loadSaved = async () => {\n      const photosString = await get('photos');\n      const photosInStorage = photosString ? JSON.parse(photosString) : []; // If running on the web...\n\n      if (!isPlatform('hybrid')) {\n        for (let photo of photosInStorage) {\n          const file = await readFile({\n            path: photo.filepath,\n            directory: FilesystemDirectory.Data\n          }); // Web platform only: Save the photo into the base64 field\n\n          photo.base64 = `data:image/jpeg;base64,${file.data}`;\n        }\n      }\n\n      setPhotos(photosInStorage);\n    };\n\n    loadSaved();\n  }, [get, readFile]);\n\n  const takePhoto = async () => {\n    const cameraPhoto = await getPhoto({\n      resultType: CameraResultType.Uri,\n      source: CameraSource.Camera,\n      quality: 100\n    });\n    const fileName = new Date().getTime() + '.jpeg';\n    const savedFileImage = await savePicture(cameraPhoto, fileName);\n    const newPhotos = [savedFileImage, ...photos];\n    set(PHOTO_STORAGE, isPlatform('hybrid') ? JSON.stringify(newPhotos) : JSON.stringify(newPhotos.map(p => {\n      // Don't save the base64 representation of the photo data,\n      // since it's already saved on the Filesystem\n      const photoCopy = { ...p\n      };\n      delete photoCopy.base64;\n      return photoCopy;\n    })));\n  };\n\n  return {\n    deletePhoto,\n    photos,\n    takePhoto\n  };\n}","map":{"version":3,"sources":["/home/bane/2019-2020/HelloIonic/photo-gallery/src/hooks/usePhotoGallery.tsx"],"names":["useState","useEffect","useCamera","useFilesystem","base64FromPath","useStorage","isPlatform","CameraResultType","CameraSource","Capacitor","FilesystemDirectory","PHOTO_STORAGE","usePhotoGallery","get","set","deleteFile","getUri","readFile","writeFile","getPhoto","photos","setPhotos","savePicture","photo","fileName","base64Data","file","path","data","webPath","directory","Data","getPhotoFile","deletePhoto","newPhotos","filter","p","filepath","JSON","stringify","filename","substr","lastIndexOf","cameraPhoto","fileUri","uri","webviewPath","convertFileSrc","loadSaved","photosString","photosInStorage","parse","base64","takePhoto","resultType","Uri","source","Camera","quality","Date","getTime","savedFileImage","map","photoCopy"],"mappings":"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","sourcesContent":["import { useState, useEffect } from \"react\";\nimport { useCamera } from '@ionic/react-hooks/camera';\nimport { useFilesystem, base64FromPath } from '@ionic/react-hooks/filesystem';\nimport { useStorage } from '@ionic/react-hooks/storage';\nimport { isPlatform } from '@ionic/react';\nimport { CameraResultType, CameraSource, CameraPhoto, Capacitor, FilesystemDirectory } from \"@capacitor/core\";\n\nconst PHOTO_STORAGE = \"photos\";\nexport function usePhotoGallery() {\n\n  const { get, set } = useStorage();\n\n  const { deleteFile, getUri, readFile, writeFile } = useFilesystem();\n  const { getPhoto } = useCamera();\n  const [photos, setPhotos] = useState<Photo[]>([]);\n\n\n\n  const savePicture = async (photo: CameraPhoto, fileName: string) => {\n    let base64Data: string;\n    // \"hybrid\" will detect Cordova or Capacitor;\n    if (isPlatform('hybrid')) {\n      const file = await readFile({\n        path: photo.path!\n      });\n      base64Data = file.data;\n    } else {\n      base64Data = await base64FromPath(photo.webPath!);\n    }\n    await writeFile({\n      path: fileName,\n      data: base64Data,\n      directory: FilesystemDirectory.Data\n    });\n    return getPhotoFile(photo, fileName);\n  };\n\n\n  const deletePhoto = async (photo: Photo) => {\n    // Remove this photo from the Photos reference data array\n    const newPhotos = photos.filter(p => p.filepath !== photo.filepath);\n\n    // Update photos array cache by overwriting the existing photo array\n    set(PHOTO_STORAGE, JSON.stringify(newPhotos));\n\n    // delete photo file from filesystem\n    const filename = photo.filepath.substr(photo.filepath.lastIndexOf('/') + 1);\n    await deleteFile({\n      path: filename,\n      directory: FilesystemDirectory.Data\n    });\n    setPhotos(newPhotos);\n  };\n\n\n\n  const getPhotoFile = async (cameraPhoto: CameraPhoto, fileName: string): Promise<Photo> => {\n    if (isPlatform('hybrid')) {\n      // Get the new, complete filepath of the photo saved on filesystem\n      const fileUri = await getUri({\n        directory: FilesystemDirectory.Data,\n        path: fileName\n      });\n\n      // Display the new image by rewriting the 'file://' path to HTTP\n      // Details: https://ionicframework.com/docs/core-concepts/webview#file-protocol\n      return {\n        filepath: fileUri.uri,\n        webviewPath: Capacitor.convertFileSrc(fileUri.uri),\n      };\n    }\n    else {\n      // Use webPath to display the new image instead of base64 since it's\n      // already loaded into memory\n      return {\n        filepath: fileName,\n        webviewPath: cameraPhoto.webPath\n      };\n    }\n  };\n\n\n\n\n\n  useEffect(() => {\n      const loadSaved = async () => {\n        const photosString = await get('photos');\n        const photosInStorage = (photosString ? JSON.parse(photosString) : []) as Photo[];\n        // If running on the web...\n        if (!isPlatform('hybrid')) {\n          for (let photo of photosInStorage) {\n            const file = await readFile({\n              path: photo.filepath,\n              directory: FilesystemDirectory.Data\n            });\n            // Web platform only: Save the photo into the base64 field\n            photo.base64 = `data:image/jpeg;base64,${file.data}`;\n          }\n        }\n        setPhotos(photosInStorage);\n      };\n    loadSaved();\n  }, [get, readFile]);\n\n\n  const takePhoto = async () => {\n    const cameraPhoto = await getPhoto({\n      resultType: CameraResultType.Uri,\n      source: CameraSource.Camera,\n      quality: 100\n    });\n    const fileName = new Date().getTime() + '.jpeg';\n    const savedFileImage = await savePicture(cameraPhoto, fileName);\n    const newPhotos = [savedFileImage, ...photos];\n    set(PHOTO_STORAGE,\n      isPlatform('hybrid')\n        ? JSON.stringify(newPhotos)\n        : JSON.stringify(newPhotos.map(p => {\n          // Don't save the base64 representation of the photo data,\n          // since it's already saved on the Filesystem\n          const photoCopy = { ...p };\n          delete photoCopy.base64;\n          return photoCopy;\n        })));\n  };\n\n  return {\n    deletePhoto,\n    photos,\n    takePhoto\n  };\n\n\n}\n\nexport interface Photo {\n  filepath: string;\n  webviewPath?: string;\n  base64?: string;\n}\n\n\n\n"]},"metadata":{},"sourceType":"module"}