{"ast":null,"code":"import _objectSpread from\"/home/bane/2019-2020/HelloIonic/photo-gallery/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"/home/bane/2019-2020/HelloIonic/photo-gallery/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _createForOfIteratorHelper from\"/home/bane/2019-2020/HelloIonic/photo-gallery/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _regeneratorRuntime from\"/home/bane/2019-2020/HelloIonic/photo-gallery/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/bane/2019-2020/HelloIonic/photo-gallery/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/bane/2019-2020/HelloIonic/photo-gallery/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useState,useEffect}from\"react\";import{useCamera}from'@ionic/react-hooks/camera';import{useFilesystem,base64FromPath}from'@ionic/react-hooks/filesystem';import{useStorage}from'@ionic/react-hooks/storage';import{isPlatform}from'@ionic/react';import{CameraResultType,CameraSource,Capacitor,FilesystemDirectory}from\"@capacitor/core\";var PHOTO_STORAGE=\"photos\";export function usePhotoGallery(){var _useStorage=useStorage(),get=_useStorage.get,set=_useStorage.set;var _useFilesystem=useFilesystem(),deleteFile=_useFilesystem.deleteFile,getUri=_useFilesystem.getUri,readFile=_useFilesystem.readFile,writeFile=_useFilesystem.writeFile;var _useCamera=useCamera(),getPhoto=_useCamera.getPhoto;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),photos=_useState2[0],setPhotos=_useState2[1];var savePicture=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(photo,fileName){var base64Data,file;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!isPlatform('hybrid')){_context.next=7;break;}_context.next=3;return readFile({path:photo.path});case 3:file=_context.sent;base64Data=file.data;_context.next=10;break;case 7:_context.next=9;return base64FromPath(photo.webPath);case 9:base64Data=_context.sent;case 10:_context.next=12;return writeFile({path:fileName,data:base64Data,directory:FilesystemDirectory.Data});case 12:return _context.abrupt(\"return\",getPhotoFile(photo,fileName));case 13:case\"end\":return _context.stop();}}},_callee);}));return function savePicture(_x,_x2){return _ref.apply(this,arguments);};}();var getPhotoFile=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(cameraPhoto,fileName){var fileUri;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!isPlatform('hybrid')){_context2.next=7;break;}_context2.next=3;return getUri({directory:FilesystemDirectory.Data,path:fileName});case 3:fileUri=_context2.sent;return _context2.abrupt(\"return\",{filepath:fileUri.uri,webviewPath:Capacitor.convertFileSrc(fileUri.uri)});case 7:return _context2.abrupt(\"return\",{filepath:fileName,webviewPath:cameraPhoto.webPath});case 8:case\"end\":return _context2.stop();}}},_callee2);}));return function getPhotoFile(_x3,_x4){return _ref2.apply(this,arguments);};}();useEffect(function(){var loadSaved=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var photosString,photosInStorage,_iterator,_step,photo,file;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return get('photos');case 2:photosString=_context3.sent;photosInStorage=photosString?JSON.parse(photosString):[];// If running on the web...\nif(isPlatform('hybrid')){_context3.next=24;break;}_iterator=_createForOfIteratorHelper(photosInStorage);_context3.prev=6;_iterator.s();case 8:if((_step=_iterator.n()).done){_context3.next=16;break;}photo=_step.value;_context3.next=12;return readFile({path:photo.filepath,directory:FilesystemDirectory.Data});case 12:file=_context3.sent;// Web platform only: Save the photo into the base64 field\nphoto.base64=\"data:image/jpeg;base64,\".concat(file.data);case 14:_context3.next=8;break;case 16:_context3.next=21;break;case 18:_context3.prev=18;_context3.t0=_context3[\"catch\"](6);_iterator.e(_context3.t0);case 21:_context3.prev=21;_iterator.f();return _context3.finish(21);case 24:setPhotos(photosInStorage);case 25:case\"end\":return _context3.stop();}}},_callee3,null,[[6,18,21,24]]);}));return function loadSaved(){return _ref3.apply(this,arguments);};}();loadSaved();},[get,readFile]);var takePhoto=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var cameraPhoto,fileName,savedFileImage,newPhotos;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return getPhoto({resultType:CameraResultType.Uri,source:CameraSource.Camera,quality:100});case 2:cameraPhoto=_context4.sent;fileName=new Date().getTime()+'.jpeg';_context4.next=6;return savePicture(cameraPhoto,fileName);case 6:savedFileImage=_context4.sent;newPhotos=[savedFileImage].concat(_toConsumableArray(photos));set(PHOTO_STORAGE,isPlatform('hybrid')?JSON.stringify(newPhotos):JSON.stringify(newPhotos.map(function(p){// Don't save the base64 representation of the photo data,\n// since it's already saved on the Filesystem\nvar photoCopy=_objectSpread({},p);delete photoCopy.base64;return photoCopy;})));case 9:case\"end\":return _context4.stop();}}},_callee4);}));return function takePhoto(){return _ref4.apply(this,arguments);};}();return{photos:photos,takePhoto:takePhoto};}","map":{"version":3,"sources":["/home/bane/2019-2020/HelloIonic/photo-gallery/src/hooks/usePhotoGallery.tsx"],"names":["useState","useEffect","useCamera","useFilesystem","base64FromPath","useStorage","isPlatform","CameraResultType","CameraSource","Capacitor","FilesystemDirectory","PHOTO_STORAGE","usePhotoGallery","get","set","deleteFile","getUri","readFile","writeFile","getPhoto","photos","setPhotos","savePicture","photo","fileName","path","file","base64Data","data","webPath","directory","Data","getPhotoFile","cameraPhoto","fileUri","filepath","uri","webviewPath","convertFileSrc","loadSaved","photosString","photosInStorage","JSON","parse","base64","takePhoto","resultType","Uri","source","Camera","quality","Date","getTime","savedFileImage","newPhotos","stringify","map","p","photoCopy"],"mappings":"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","sourcesContent":["import { useState, useEffect } from \"react\";\nimport { useCamera } from '@ionic/react-hooks/camera';\nimport { useFilesystem, base64FromPath } from '@ionic/react-hooks/filesystem';\nimport { useStorage } from '@ionic/react-hooks/storage';\nimport { isPlatform } from '@ionic/react';\nimport { CameraResultType, CameraSource, CameraPhoto, Capacitor, FilesystemDirectory } from \"@capacitor/core\";\n\nconst PHOTO_STORAGE = \"photos\";\nexport function usePhotoGallery() {\n\n  const { get, set } = useStorage();\n\n  const { deleteFile, getUri, readFile, writeFile } = useFilesystem();\n  const { getPhoto } = useCamera();\n  const [photos, setPhotos] = useState<Photo[]>([]);\n\n\n\n  const savePicture = async (photo: CameraPhoto, fileName: string) => {\n    let base64Data: string;\n    // \"hybrid\" will detect Cordova or Capacitor;\n    if (isPlatform('hybrid')) {\n      const file = await readFile({\n        path: photo.path!\n      });\n      base64Data = file.data;\n    } else {\n      base64Data = await base64FromPath(photo.webPath!);\n    }\n    await writeFile({\n      path: fileName,\n      data: base64Data,\n      directory: FilesystemDirectory.Data\n    });\n    return getPhotoFile(photo, fileName);\n  };\n\n\n\n\n  const getPhotoFile = async (cameraPhoto: CameraPhoto, fileName: string): Promise<Photo> => {\n    if (isPlatform('hybrid')) {\n      // Get the new, complete filepath of the photo saved on filesystem\n      const fileUri = await getUri({\n        directory: FilesystemDirectory.Data,\n        path: fileName\n      });\n\n      // Display the new image by rewriting the 'file://' path to HTTP\n      // Details: https://ionicframework.com/docs/core-concepts/webview#file-protocol\n      return {\n        filepath: fileUri.uri,\n        webviewPath: Capacitor.convertFileSrc(fileUri.uri),\n      };\n    }\n    else {\n      // Use webPath to display the new image instead of base64 since it's\n      // already loaded into memory\n      return {\n        filepath: fileName,\n        webviewPath: cameraPhoto.webPath\n      };\n    }\n  };\n\n\n\n\n\n  useEffect(() => {\n      const loadSaved = async () => {\n        const photosString = await get('photos');\n        const photosInStorage = (photosString ? JSON.parse(photosString) : []) as Photo[];\n        // If running on the web...\n        if (!isPlatform('hybrid')) {\n          for (let photo of photosInStorage) {\n            const file = await readFile({\n              path: photo.filepath,\n              directory: FilesystemDirectory.Data\n            });\n            // Web platform only: Save the photo into the base64 field\n            photo.base64 = `data:image/jpeg;base64,${file.data}`;\n          }\n        }\n        setPhotos(photosInStorage);\n      };\n    loadSaved();\n  }, [get, readFile]);\n\n\n  const takePhoto = async () => {\n    const cameraPhoto = await getPhoto({\n      resultType: CameraResultType.Uri,\n      source: CameraSource.Camera,\n      quality: 100\n    });\n    const fileName = new Date().getTime() + '.jpeg';\n    const savedFileImage = await savePicture(cameraPhoto, fileName);\n    const newPhotos = [savedFileImage, ...photos];\n    set(PHOTO_STORAGE,\n      isPlatform('hybrid')\n        ? JSON.stringify(newPhotos)\n        : JSON.stringify(newPhotos.map(p => {\n          // Don't save the base64 representation of the photo data,\n          // since it's already saved on the Filesystem\n          const photoCopy = { ...p };\n          delete photoCopy.base64;\n          return photoCopy;\n        })));\n  };\n\n  return {\n    photos,\n    takePhoto\n  };\n\n\n}\n\nexport interface Photo {\n  filepath: string;\n  webviewPath?: string;\n  base64?: string;\n}\n\n\n\n"]},"metadata":{},"sourceType":"module"}